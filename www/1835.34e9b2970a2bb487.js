"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1835],{1835:(I,f,a)=>{a.r(f),a.d(f,{Tab1PageModule:()=>w});var n=a(4556),u=a(6895),g=a(433),d=a(2598),c=a(655),m=a(9300),b=a(7729),e=a(8256),v=a(427),P=a(9894);const T=["popover"];function x(o,r){1&o&&e._UZ(0,"ion-icon",16)}function M(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"div",17)(2,"div",18)(3,"div",19)(4,"h2",20)(5,"ion-text",0),e._uU(6,"Sweet dreams"),e.qZA()(),e.TgZ(7,"p")(8,"ion-text",21),e._uU(9,"It's 9:00 PM"),e.qZA()(),e.TgZ(10,"div",22)(11,"ion-button",23),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.saveSleepPost())}),e._uU(12," Sleep "),e._UZ(13,"ion-icon",24),e.qZA()()()()()()}}const S=[{path:"",component:(()=>{class o{constructor(t,i,s){this.apiService=t,this.router=i,this.modalCtrl=s,this.isOpen=!1,this.newNotification="false",t.getUserProfile(),this.profile=this.apiService.profile,this.userId=this.profile.id}ngOnInit(){return(0,c.mG)(this,void 0,void 0,function*(){this.newNotification=yield localStorage.getItem("newNotifications"),this.apiService.getUserProfile(),this.profile=this.apiService.profile,this.updateFeeds(),this.connectTorealtime(),this.router.events.pipe((0,m.h)(t=>t instanceof d.m2)).subscribe(t=>{console.log("router:",t.urlAfterRedirects),"/tabs/tab1"===t.urlAfterRedirects?(this.apiService.checkNontifications(),this.newNotification=localStorage.getItem("newNotifications"),"true"===localStorage.getItem("newFriend")&&(this.updateFeeds(),this.connectTorealtime(),localStorage.setItem("newFriend","false"))):this.apiService.checkNontifications()})})}handleRefresh(t){setTimeout(()=>{this.ngOnInit(),t.target.complete()},1e3)}saveSleepPost(){return(0,c.mG)(this,void 0,void 0,function*(){var t={authorId:this.profile.id,sleep:!0,reactions:[]};yield this.apiService.savePost(t),this.isOpen=!1})}updateFeeds(){this.apiService.getFeed().then(t=>this.allPosts=t)}connectTorealtime(){return(0,c.mG)(this,void 0,void 0,function*(){yield this.apiService.supabase.auth.getUser(),console.log("this.profile['friends']::: ",this.profile.friends.toString()),this.apiService.supabase.channel("schema-db-changes").on("postgres_changes",{event:"*",schema:"public",table:"posts",filter:"authorId=in.("+this.profile.friends.toString()+")"},i=>(0,c.mG)(this,void 0,void 0,function*(){console.log("Payload in realtime",i);const s=i.new;if("INSERT"==i.eventType){let l=yield this.apiService.supabase.from("posts").select("*, profiles(id,full_name, avatar_url),comments:first_comment(*)").eq("id",s.id).single();console.log("new post from database :",l.data),this.allPosts.unshift(l.data),console.log("new allPost:",this.allPosts)}if("UPDATE"===i.eventType){const l=i.new.id,p=this.allPosts.findIndex(h=>h.id===l);if(-1!==p){if(yield this.apiService.supabase.from("posts"),this.allPosts[p].reactions=i.new.reactions,null!=i.new.first_comment){let F=yield this.apiService.supabase.from("comments").select("content,profiles(full_name)").eq("id",i.new.first_comment).single();this.allPosts[p].comments=F.data}console.log("updated post from database :",s,this.allPosts)}}if("DELETE"===i.eventType){console.log("Post deleted ",i);const l=this.allPosts.findIndex(p=>p.id===i.old.id);this.allPosts.splice(l,1)}})).subscribe(i=>{console.log(i)})})}openModal(){return(0,c.mG)(this,void 0,void 0,function*(){this.isOpen=!0})}isOpentoFalse(t){this.isOpen=!1}openPostModal(){return(0,c.mG)(this,void 0,void 0,function*(){(yield this.modalCtrl.create({breakpoints:[.5,.5,.5,1],initialBreakpoint:.8,component:b.s})).present()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(v.s),e.Y36(d.F0),e.Y36(n.IN))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-tab1"]],viewQuery:function(t,i){if(1&t&&(e.Gf(T,5),e.Gf(n.ki,5)),2&t){let s;e.iGM(s=e.CRH())&&(i.popover=s.first),e.iGM(s=e.CRH())&&(i.modal=s.first)}},decls:21,vars:7,consts:[["color","danger"],["slot","end"],["routerLink","/notification","shape","round"],["name","notifications"],["class","notification1","name","notifications-circle-outline",4,"ngIf"],[1,"ion-padding"],["slot","fixed",1,"ion-padding",2,"background-color","#F1F1F1","height","300px",3,"pullFactor","pullMin","pullMax","ionRefresh"],[3,"posts","myId"],["slot","fixed","vertical","bottom","horizontal","end"],["name","add"],["side","top"],["color","primary",3,"click"],["name","image"],["color","success",3,"click"],["name","moon"],[3,"isOpen","willDismiss"],["name","notifications-circle-outline",1,"notification1"],[1,"innerDiv",2,"height","auto"],[1,"upperLayer"],[1,"ion-text-center","ion-padding-top","ion-margin-top"],[1,"bold"],[2,"color","rgb(68, 68, 68)"],[1,"ion-text-center"],["color","danger",2,"color","#4D00FF",3,"click"],["color","light","name","moon"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3," Social "),e.qZA(),e.TgZ(4,"ion-buttons",1)(5,"ion-button",2),e._UZ(6,"ion-icon",3),e.YNc(7,x,1,0,"ion-icon",4),e.qZA()()()(),e.TgZ(8,"ion-content",5)(9,"ion-refresher",6),e.NdJ("ionRefresh",function(l){return i.handleRefresh(l)}),e.qZA(),e._UZ(10,"app-social-post",7),e.TgZ(11,"ion-fab",8)(12,"ion-fab-button",0),e._UZ(13,"ion-icon",9),e.qZA(),e.TgZ(14,"ion-fab-list",10)(15,"ion-fab-button",11),e.NdJ("click",function(){return i.openPostModal()}),e._UZ(16,"ion-icon",12),e.qZA(),e.TgZ(17,"ion-fab-button",13),e.NdJ("click",function(){return i.openModal()}),e._UZ(18,"ion-icon",14),e.qZA()()()(),e.TgZ(19,"ion-modal",15),e.NdJ("willDismiss",function(l){return i.isOpentoFalse(l)}),e.YNc(20,M,14,0,"ng-template"),e.qZA()),2&t&&(e.xp6(7),e.Q6J("ngIf","true"===i.newNotification),e.xp6(2),e.Q6J("pullFactor",.5)("pullMin",100)("pullMax",200),e.xp6(1),e.Q6J("posts",i.allPosts)("myId",i.userId),e.xp6(9),e.Q6J("isOpen",i.isOpen))},dependencies:[n.YG,n.Sm,n.W2,n.IJ,n.W4,n.zq,n.Gu,n.gu,n.nJ,n.yW,n.wd,n.sr,n.ki,n.YI,u.O5,P.W,d.rH],styles:[".searchBar[_ngcontent-%COMP%]{border-radius:30px!important}.imgContainer[_ngcontent-%COMP%]{padding:2px}.imgContainer[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100px;object-fit:cover}.notification1[_ngcontent-%COMP%]{width:10px;height:10px;position:absolute;z-index:999;left:15px;object-fit:contain;top:21px}.modal-hight[_ngcontent-%COMP%]   .modal-wrapper[_ngcontent-%COMP%]{top:100%;left:0;display:block;width:100%;height:100%}ion-modal[_ngcontent-%COMP%]{--height: 280px;width:95%;--border-radius: 16px;opacity:.95;margin:auto;--box-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1)}ion-modal[_ngcontent-%COMP%]::part(backdrop){background:rgb(209,213,219);opacity:1}"]}),o})()}];let Z=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[d.Bz.forChild(S),d.Bz]}),o})();var _=a(5642);let w=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[n.Pc,u.ez,g.u5,_.K,Z]}),o})()}}]);